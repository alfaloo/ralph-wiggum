# Ralph Wiggum

A CLI-driven agentic coding framework that manages context and prompt quality to get better results from AI coding agents.

## What is Ralphing?

Agentic coding tools are powerful, but two problems routinely limit their effectiveness:

1. **Poor prompts.** Most users miss important details when specifying a task. Vague or incomplete requirements lead to agents that implement the wrong thing. Ralph addresses this by running an *interview* phase: before any code is written, an agent reads your spec and asks targeted clarifying questions. You answer them, and the spec is updated to be precise enough to drive accurate implementation.

2. **Context window degradation.** Agentic models have a limited context window. Long-running sessions trigger automatic context compression, and since the model has no principled way to decide what matters, performance degrades significantly. Ralph avoids this entirely: instead of one long-running agent, it spawns a fresh agent for each task with only the essential context — the project spec, the task list, and the history of completed work. Each iteration starts clean.

## Installation

Clone this repository and install the Ralph CLI using pip:

```bash
pip install -e .
```

If the `pip install` fails, a possible solution would be to use `pipx install` instead.

[pipx](https://pipx.pypa.io/) installs the tool into an isolated virtual environment while making the `ralph` command available globally, so it does not interfere with your system Python or project dependencies.

## Caveats

- Ralph currently invokes Claude Code with `--dangerously-skip-permissions`, which means the execute agents run without confirmation prompts. All file writes, shell commands, and git operations happen automatically. Run it on code you have committed or backed up.
- The `ralph pr` command requires the [GitHub CLI (`gh`)](https://cli.github.com/) to be installed and authenticated.

## Commands

### `ralph init <project-name>`

Initialises a new project. Creates `.ralph/<project-name>/` containing:
- `spec.md` — a template spec file for you to fill in
- `tasks.json`, `state.json`, `obstacles.json` — tracking files used by the agents

Also creates `.ralph/settings.json` with default values for global flags if it does not already exist.

---

### `ralph interview <project-name> [--rounds N] [--verbose BOOL]`

Runs one or more interview rounds to refine the spec. Each round has two phases:
1. An agent reads `spec.md` and outputs 3–5 clarifying questions.
2. You type your answers; a second agent incorporates them into `spec.md` and writes/refreshes `tasks.json`.

`--rounds N` (alias `-r`) controls how many rounds to run. Defaults to the persisted `rounds` setting (default: 1).

---

### `ralph comment <project-name> "<comment>" [--verbose BOOL]`

A lightweight alternative to `ralph interview` for quick spec amendments. Passes your comment directly to an agent, which updates `spec.md` and refreshes `tasks.json` without an interactive Q&A round.

---

### `ralph execute <project-name> [--limit N] [--base BRANCH] [--verbose BOOL] [--resume]`

Implements the project by spawning execute agents iteratively. Each agent picks up the next pending task from `tasks.json`, implements it, commits the changes, and updates the task status.

- Creates a new branch named `<project-name>` branched from `<base>` (default: `main`). Aborts if the branch already exists.
- Stops when all tasks are complete, a task exceeds its `max_attempts`, the iteration limit is reached, or the Claude Code usage limit is hit.
- At the end, spawns a summary agent that writes `summary.md` and `pr-description.md` to the artifact directory.
- `--limit N` (alias `-l`) sets the maximum number of agent iterations (default: 20).
- `--base BRANCH` (alias `-b`) sets the branch to branch from (default: `main`).
- `--resume` (alias `-r`) resumes execution on an existing project branch instead of creating a new one.

---

### `ralph oneshot <project-name> [--limit N] [--base BRANCH] [--verbose BOOL]`

Runs the full pipeline in one command: enriches the spec, generates tasks, executes agents, and creates a GitHub PR. Requires a clean working tree. Useful for straightforward tasks where interactive interview rounds are not needed.

---

### `ralph pr <project-name>`

Pushes the project branch to `origin` and opens a GitHub pull request using the `pr-description.md` generated by the execute step. Requires the `gh` CLI.

---

### Global flags

When used at the top level (before or without a subcommand), these flags persist their values to `.ralph/settings.json`:

| Flag | Alias | Default | Description |
|------|-------|---------|-------------|
| `--verbose true\|false` | `-v` | `false` | Print agent stdout during runs |
| `--rounds N` | `-r` | `1` | Default number of interview rounds |
| `--limit N` | `-l` | `20` | Default max execute iterations |
| `--base BRANCH` | `-b` | `main` | Default base branch for execute |

Per-command flags (e.g. `ralph interview my-project --rounds 3`) override the persisted setting for that invocation only.

## Workflow

### 1. Initialise the project

```bash
ralph init my-feature
```

This creates `.ralph/my-feature/spec.md`. Open it and fill in the Overview, Goals, Requirements, and any technical constraints. The more detail you provide here, the better the agent output.

### 2. Run the interview (optional but recommended)

```bash
ralph interview my-feature --rounds 2
```

For each round, the agent asks clarifying questions. Answer them in the terminal; the spec and task list are updated automatically. Run multiple rounds for complex projects.

Alternatively, use `ralph comment` to push a specific amendment without the Q&A loop:

```bash
ralph comment my-feature "Add rate limiting to all API endpoints"
```

### 3. Execute

```bash
ralph execute my-feature
```

Ralph creates a branch `my-feature` from `main`, then spawns agents one at a time. Each agent picks up one task, implements it, commits the changes, and marks the task complete. Progress is tracked in `tasks.json` and `state.json`.

When done (or on early exit), a summary is written to `.ralph/my-feature/summary.md`.

### 4. Create the PR

```bash
ralph pr my-feature
```

Pushes the branch and opens a GitHub PR using the auto-generated `pr-description.md`.

---

### Resuming a partial execution

If `ralph execute` was interrupted, resume from where it left off:

```bash
ralph execute my-feature --resume
```

### Fully automated (oneshot)

For simpler tasks where you want to skip the interview:

```bash
ralph oneshot my-feature
```

This runs comment → execute → pr in sequence, with a built-in spec-enrichment step before task generation.
